<!DOCTYPE html>
<html>
  <head>
    <title>Three.js Car Game</title>
    <style>
      body { margin: 0; overflow: hidden; }
      canvas { display: block; }
    </style>
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

    <script>
      // -------------------------------------------------------
      // Basic Setup
      // -------------------------------------------------------
      const scene = new THREE.Scene();
      scene.background = new THREE.Color(0x87ceeb);

      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 10, 20);
      camera.lookAt(0, 0, 0);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // -------------------------------------------------------
      // Lights
      // -------------------------------------------------------
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(10, 20, 10);
      scene.add(light);

      const ambient = new THREE.AmbientLight(0xffffff, 0.4);
      scene.add(ambient);

      // -------------------------------------------------------
      // Ground
      // -------------------------------------------------------
      const groundGeom = new THREE.PlaneGeometry(500, 500);
      const groundMat = new THREE.MeshLambertMaterial({ color: 0x228B22 });
      const ground = new THREE.Mesh(groundGeom, groundMat);
      ground.rotation.x = -Math.PI / 2;
      scene.add(ground);

      // -------------------------------------------------------
      // Car (simple box)
      // -------------------------------------------------------
      const carGeom = new THREE.BoxGeometry(2, 1, 4);
      const carMat = new THREE.MeshLambertMaterial({ color: 0xff0000 });
      const car = new THREE.Mesh(carGeom, carMat);
      car.position.y = 0.5;
      scene.add(car);

      // -------------------------------------------------------
      // Car Physics Variables
      // -------------------------------------------------------
      let speed = 0;
      const maxSpeed = 0.5;
      const acceleration = 0.01;
      const friction = 0.005;
      const turnSpeed = 0.03;

      const keys = {};

      window.addEventListener("keydown", (e) => {
        keys[e.code] = true;
      });

      window.addEventListener("keyup", (e) => {
        keys[e.code] = false;
      });

      // -------------------------------------------------------
      // Game Loop
      // -------------------------------------------------------
      function animate() {
        requestAnimationFrame(animate);

        // ACCELERATE
        if (keys["ArrowUp"]) speed += acceleration;
        if (keys["ArrowDown"]) speed -= acceleration;

        // LIMIT SPEED
        speed = Math.min(Math.max(speed, -maxSpeed), maxSpeed);

        // TURN (only if moving)
        if (speed !== 0) {
          if (keys["ArrowLeft"]) car.rotation.y += turnSpeed;
          if (keys["ArrowRight"]) car.rotation.y -= turnSpeed;
        }

        // Apply friction
        if (!keys["ArrowUp"] && !keys["ArrowDown"]) {
          if (speed > 0) speed -= friction;
          if (speed < 0) speed += friction;
          if (Math.abs(speed) < friction) speed = 0;
        }

        // Move forward
        car.position.x += Math.sin(car.rotation.y) * speed;
        car.position.z += Math.cos(car.rotation.y) * speed;

        // Camera follows behind the car
        camera.position.lerp(
          new THREE.Vector3(
            car.position.x - Math.sin(car.rotation.y) * 10,
            car.position.y + 5,
            car.position.z - Math.cos(car.rotation.y) * 10
          ),
          0.05
        );
        camera.lookAt(car.position);

        renderer.render(scene, camera);
      }

      animate();

      // Resize handler
      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    </script>
  </body>
</html>
